String.prototype.escapeHTML=function(){return(this.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;"))};var $version="0.5.0";var started=0;var cols={},messageIsOpen=false;$(function(){startTime(1);$("input").attr("autocomplete","off");$(window).hashchange(function(){var f=location.hash.replace(/^#/,"");if(f===""){$(".trigger-message-close").trigger("click")}});var e=$("#perfectScroll");if(e.length){new PerfectScrollbar("#perfectScroll")}var d=$(".perfectScroll");if(d.length){new PerfectScrollbar(".perfectScroll")}new PerfectScrollbar("#pScrollerMenu");initModal();var a=$(".tt");if(a.length){initTooltips(".tt")}var c=$(".calendar");if(c.length){initCalendar(".calendar")}$(window).hashchange();var b=$("#"+GetNav);if(!b.is(":visible")){b.parent().prev("a").trigger("click")}b.addClass("active");initOverlays();detectHash();$(".search-box input").on("focus",function(){if($(window).width()<=1360){cols.hideMessage()}})});$(document).on("click",".toggleTree",function(b){b.preventDefault();var c=$(this).next(".treeMenu");var a=$(this).children("i");if(c.is(":visible")){a.removeClass("fa-chevron-down").addClass("fa-chevron-right")}else{a.removeClass("fa-chevron-right").addClass("fa-chevron-down")}c.toggle(200)});$(document).on("click",".clickable",function(c){c.preventDefault();if(!$(this).hasClass("innerMessage")){window.location.hash=$(this).attr("data-hash")}if($(this).hasClass("search-box")){$(".js-search-message").trigger("click")}var b=Math.floor((Math.random()*10000)+1);$("body").append('<div class="messageFly" id="'+b+'"></div>');var a=$("#"+b);a.show();loadDetails($(this),b);if(messageIsOpen){if(!$(this).hasClass("innerMessage")){cols.hideMessage()}setTimeout(function(){cols.showMessage()},300)}else{cols.showMessage()}cols.showOverlay()});$(document).on("click","#js-add-rate",function(f){f.preventDefault();var d=$(this);var c=d.attr("data-url");var a=$("#js-result-table");var b='Would you like to add another Ratetype?<br />\n<div class="row">\n    <div class="col-10">\n        <input placeholder="Rate Name (e.g. Best available Rate)" value="" type="text" id="rate-name"/>\n    </div>\n</div>\n<div class="row">\n    <div class="col-10">\n        <input placeholder="Rate Name Short (e.g. BAR)" value="" type="text" id="rate-name-short"/>\n    </div>\n</div>\n<div class="row">\n    <div class="col-8">\n        <input placeholder="Discount from BaseRate" value="" type="text" id="rate-dc-amount"/>\n    </div>\n    <div class="col-2">\n        <select id="rate-dc-type" style="margin-top:30%;">\n            <option value="p">&percnt;</option>\n            <option value="e">&euro;</option>\n        </select>\n    </div>\n</div>\n<div class="row">\n    <div class="col-10">\n        <input placeholder="Minimum Stay" value="" type="text" id="rate-min-stay"/>\n    </div>\n</div>\n<div class="row">\n    <div class="col-10">\n        <input placeholder="Days in Advance" value="" type="text" id="rate-pre-days"/>\n    </div>\n</div>\n<div class="row">\n    <div class="col-1">\n        <input style="position:relative;top:10px;" type="checkbox" id="rate-is-base">\n    </div>\n    <div class="col-9">\n        <span style="position:relative;top:10px;">is Baserate<br />(Discounts will be applied from this rate)</span>\n    </div>\n</div>';x0p({title:"Add Ratetype",text:b,html:true,height:"70%",maxHeight:"550px",maxWidth:"500px",animationType:"fadeIn",buttons:[{type:"ok",text:"Save",showLoading:true},{type:"error",text:"Cancel",showLoading:false}]}).then(function(l){if(l.button==="ok"){var i=$.trim($("#rate-name").val());var k=$.trim($("#rate-name-short").val());var m=$("#rate-is-base:checked").val()?"yes":"no";var e=$.trim($("#rate-dc-amount").val());var j=$.trim($("#rate-min-stay").val());var h=$.trim($("#rate-pre-days").val());var g=$.trim($("#rate-dc-type").val());$.post(c,{name:i,nameShort:k,isBase:m,dcAmount:e,dcType:g,minStay:j,preDays:h}).done(function(n){if(n.result==="success"){a.append('<div class="row table-font" style="border-bottom:1px solid #ccc;" id="row_'+n.extra.type+"_"+n.extra.id+'">\n       <div class="col-2" id="nameShort_'+n.extra.type+"_"+n.extra.id+'">'+n.extra.nameShort+'</div>\n       <div class="col-4" id="name_'+n.extra.type+"_"+n.extra.id+'">'+n.extra.name+'</div>\n       <div class="col-1" id="minStay_'+n.extra.type+"_"+n.extra.id+'">'+n.extra.minStay+'</div>\n       <div class="col-1" id="daysAdvance_'+n.extra.type+"_"+n.extra.id+'">'+n.extra.preDays+'</div>\n       <div class="col-1">'+n.extra.isBase+'</div>\n       <div class="col-1"><span class="badge badge-success" id="status_'+n.extra.type+"_"+n.extra.id+'">active</span></div>\n       <div class="col-1">\n               <span id="dc_amount_'+n.extra.type+"_"+n.extra.id+'">'+n.extra.dcAmount+'</span><span id="dc_type_'+n.extra.type+"_"+n.extra.id+'">'+n.extra.dcType+'</span>\n       </div>\n       <div class="col-1">\n               <a href="#" class="btn btn-success btn-sm rounded-0 tt clickable" title="View Details"           data-url="'+n.extra.link+'"           data-hash="details-ratetype-'+n.extra.id+'"           data-trigger="'+n.extra.id+'"       >\n                       <i class="fa fa-info-circle"></i> Details\n               </a>\n       </div>\n</div>');x0p("Success",n.extra.name+" added","ok",false)}else{x0p("Error",n.message,"error",false)}}).fail(function(){openNoty("error","Ajax Error")})}})});$(document).on("click","#js-add-room",function(f){f.preventDefault();var d=$(this);var c=d.attr("data-url");var a=$("#js-result-table");var b='Would you like to add another Roomtype?<br />\n<div class="row">\n    <div class="col-10">\n        <input placeholder="Room Name (e.g. Standard King)" value="" type="text" id="room-name"/>\n    </div>\n</div>\n<div class="row">\n    <div class="col-10">\n        <input placeholder="Room Name Short (e.g. STDK)" value="" type="text" id="room-name-short"/>\n    </div>\n</div>\n<div class="row">\n    <div class="col-10">\n        <input placeholder="Max Occupancy (e.g. 2)" value="" type="text" id="room-occ"/>\n    </div>\n</div>';x0p({title:"Add Roomtype",text:b,html:true,maxHeight:"400px",maxWidth:"500px",animationType:"fadeIn",buttons:[{type:"ok",text:"Save",showLoading:true},{type:"error",text:"Cancel",showLoading:false}]}).then(function(i){if(i.button==="ok"){var e=$.trim($("#room-name").val());var g=$.trim($("#room-name-short").val());var h=$.trim($("#room-occ").val());$.post(c,{name:e,nameShort:g,occ:h}).done(function(j){if(j.result==="success"){a.append('<div class="row table-font" style="border-bottom:1px solid #ccc;" id="row_'+j.extra.type+"_"+j.extra.id+'">\n       <div class="col-2" id="nameShort_'+j.extra.type+"_"+j.extra.id+'">'+j.extra.nameShort+'</div>\n       <div class="col-6" id="name_'+j.extra.type+"_"+j.extra.id+'">'+j.extra.name+'</div>\n       <div class="col-1" id="maxOcc_'+j.extra.type+"_"+j.extra.id+'">'+j.extra.maxOcc+'</div>\n       <div class="col-1"><span class="badge badge-success" id="status_'+j.extra.type+"_"+j.extra.id+'">active</span></div>\n       <div class="col-1">\n               <a href="#" class="btn btn-success btn-sm rounded-0 tt clickable" title="View Details"           data-url="'+j.extra.link+'"           data-hash="details-roomtype-'+j.extra.id+'"           data-trigger="'+j.extra.id+'"       >\n                       <i class="fa fa-info-circle"></i> Details\n               </a>\n       </div>\n</div>');x0p("Success",j.extra.name+" added","ok",false)}else{x0p("Error",j.message,"error",false)}}).fail(function(){openNoty("error","Ajax Error")})}})});$(document).on("click","#js-update-room",function(d){d.preventDefault();var c=$(this);var b=c.attr("data-url");var h=c.attr("data-id");var g=$("#room-name");var a=$("#room-name-short");var f=$("#room-occ");if($.trim(g.val())===""){openNoty("error","Name cannot be empty");return false}if($.trim(a.val())===""){openNoty("error","Name (Short) cannot be empty");return false}if($.trim(f.val())===""){openNoty("error","Max. Occupancy cannot be empty");return false}$.post(b,{name:g.val(),nameShort:a.val(),maxOcc:f.val(),id:h}).done(function(e){if(e.result==="success"){closeDetails(function(){var j=$("#name_"+e.extra.type+"_"+e.extra.id);var i=$("#nameShort_"+e.extra.type+"_"+e.extra.id);var k=$("#maxOcc_"+e.extra.type+"_"+e.extra.id);j.html(e.extra.name);i.html(e.extra.nameShort);k.html(e.extra.maxOcc)});x0p("Success",a.val()+" updated","ok",false)}else{x0p("Error",e.message,"error",false)}}).fail(function(){openNoty("error","Ajax Error")})});$(document).on("click","#js-add-competitor",function(f){f.preventDefault();var d=$(this);var c=d.attr("data-url");var a=$("#js-result-table");var b='Would you like to add another Competitor?<br />\n<div class="row">\n    <div class="col-10">\n        <input placeholder="Competitor Name" value="" type="text" id="competitor-name"/>\n    </div>\n</div>\n<div class="row">\n    <div class="col-10">\n        <input placeholder="Booking.com Subsite" value="" type="text" id="competitor-link"/>\n    </div>\n</div>';x0p({title:"Add Competitor",text:b,html:true,maxHeight:"400px",maxWidth:"500px",animationType:"fadeIn",buttons:[{type:"ok",text:"Save",showLoading:true},{type:"error",text:"Cancel",showLoading:false}]}).then(function(h){if(h.button==="ok"){var e=$.trim($("#competitor-name").val());var g=$.trim($("#competitor-link").val());$.post(c,{name:e,link:g}).done(function(i){if(i.result==="success"){a.append('<div class="row table-font" style="border-bottom:1px solid #ccc;" id="row_'+i.extra.type+"_"+i.extra.id+'">\n       <div class="col-3" id="name_'+i.extra.type+"_"+i.extra.id+'">'+i.extra.name+'</div>\n       <div class="col-7" id="link_'+i.extra.type+"_"+i.extra.id+'">'+i.extra.sublink+'</div>\n       <div class="col-1"><span class="badge badge-success" id="status_'+i.extra.type+"_"+i.extra.id+'">active</span></div>\n       <div class="col-1">\n               <a href="#" class="btn btn-success btn-sm rounded-0 tt clickable" title="View Details"           data-url="'+i.extra.link+'"           data-hash="details-competitor-'+i.extra.id+'"           data-trigger="'+i.extra.id+'"       >\n                       <i class="fa fa-info-circle"></i> Details\n               </a>\n       </div>\n</div>');x0p("Success",i.extra.name+" added","ok",false)}else{x0p("Error",i.message,"error",false)}}).fail(function(){openNoty("error","Ajax Error")})}})});$(document).on("click","#js-update-competitor",function(d){d.preventDefault();var c=$(this);var b=c.attr("data-url");var g=c.attr("data-id");var f=$("#competitor-name");var a=$("#competitor-link");if($.trim(f.val())===""){openNoty("error","Name cannot be empty");return false}if($.trim(a.val())===""){openNoty("error","Link cannot be empty");return false}$.post(b,{name:f.val(),link:a.val(),id:g}).done(function(e){if(e.result==="success"){closeDetails(function(){var i=$("#name_"+e.extra.type+"_"+e.extra.id);var h=$("#link_"+e.extra.type+"_"+e.extra.id);i.html(e.extra.name);h.html(e.extra.link)});x0p("Success",$name_.val()+" updated","ok",false)}else{x0p("Error",e.message,"error",false)}}).fail(function(){openNoty("error","Ajax Error")})});$(document).on("click","#js-check-competitors",function(c){c.preventDefault();var b=$(this);var a=$("#js-competitor-date");if(b.hasClass("disabled")){return false}if($.trim(a.val())===""||a.val()===null){openNoty("error","Date cannot be empty");return false}b.addClass("disabled").html('<i class="fa fa-spin fa-spinner"></i>');$(".competitor-row").each(function(f,d){var g=$(d).attr("data-id");var e=$(d).attr("data-url");started+=1;$("#room_"+g).html('<i class="fa fa-spin fa-spinner"></i> <span class="text-success">Started Query...</span>');$("#incl_"+g).html("");$("#pax_"+g).html("");$("#price_"+g).html("");$.post(e,{id:g,date:a.val()}).done(function(h){if(h.result==="success"){$("#room_"+g).html(h.extra.room);$("#incl_"+g).html(h.extra.incl);$("#pax_"+g).html(h.extra.pax);$("#price_"+g).html(h.extra.price)}else{$("#room_"+g).html('<i class="text-danger">'+h.message+"</i>")}started-=1;if(started===0){b.removeClass("disabled").html('<i class="fa fa-refresh"></i>')}}).fail(function(){started-=1;if(started===0){b.removeClass("disabled").html('<i class="fa fa-refresh"></i>')}openNoty("error","Ajax Error")})})});$(document).on("click","#js-update-rate",function(f){f.preventDefault();var i=$(this);var a=i.attr("data-url");var b=i.attr("data-id");var l=$("#rate-name");var c=$("#rate-name-short");var d=$("#rate-base");var j=$("#rate-min-stay");var h=$("#rate-days-advance");var k=$("#rate-dc-amount");var g=$("#rate-dc-type");if($.trim(l.val())===""){openNoty("error","Name cannot be empty");return false}if($.trim(c.val())===""){openNoty("error","Name (Short) cannot be empty");return false}$.post(a,{name:l.val(),nameShort:c.val(),minStay:j.val(),daysAdvance:h.val(),isBase:d.val(),id:b,dcAmount:k.val(),dcType:g.val()}).done(function(e){if(e.result==="success"){closeDetails(function(){var q=$("#name_"+e.extra.type+"_"+e.extra.id);var p=$("#nameShort_"+e.extra.type+"_"+e.extra.id);var m=$("#minStay_"+e.extra.type+"_"+e.extra.id);var s=$("#daysAdvance_"+e.extra.type+"_"+e.extra.id);var o=$("#base_"+e.extra.type+"_"+e.extra.id).parent();var n=$("#dc_amount_"+e.extra.type+"_"+e.extra.id);var r=$("#dc_type_"+e.extra.type+"_"+e.extra.id);q.html(e.extra.name);p.html(e.extra.nameShort);m.html(e.extra.minStay);s.html(e.extra.daysAdvance);o.html(e.extra.isBase);n.html(e.extra.dcAmount);r.html(e.extra.dcType)});x0p("Success",c.val()+" updated","ok",false)}else{x0p("Error",e.message,"error",false)}}).fail(function(){openNoty("error","Ajax Error")})});$(document).on("click","#js-remove-entity",function(f){f.preventDefault();var d=$(this);var b=d.attr("data-url");var a=d.attr("data-name");var c=d.attr("data-type");var g=d.attr("data-id");x0p({title:'<span style="color:#dc1327;">Attention</span>',text:"Would you like to remove <strong>"+a+'</strong>?<br /><br /><span style="color:#dc1327;">This action cannot be undone!</span>',html:true,maxHeight:"200px",maxWidth:"300px",animationType:"fadeIn",buttons:[{type:"ok",text:"Yes, remove!",showLoading:true},{type:"error",text:"Cancel",showLoading:false}]}).then(function(e){if(e.button==="ok"){$.post(b,{type:c,id:g}).done(function(h){if(h.result==="success"){closeDetails(function(){var i=$("#row_"+c+"_"+g);if(i.length){i.remove()}});x0p("Success",a+" removed","ok",false)}else{x0p("Error",h.message,"error",false)}}).fail(function(){openNoty("error","Ajax Error")})}})});$(document).on("click","#js-save-settings",function(h){h.preventDefault();var k=$(this);var g=k.html();var a=k.attr("data-url");if(k.hasClass("disabled")){return false}var l=$("#add_triple");var j=parseFloat(l.val().replace(",","."));if(j<=0||isNaN(j)){openNoty("error","Invalid Triple Room Modifier");return false}var b=$("#add_double");var c=parseFloat(b.val().replace(",","."));if(c<=0||isNaN(c)){openNoty("error","Invalid Double Room Modifier");return false}var f=$("#add_extra");var m=parseFloat(f.val().replace(",","."));if(m<=0||isNaN(m)){openNoty("error","Invalid Extra Person Modifier");return false}var d=$("#bf");var i=parseFloat(d.val().replace(",","."));if(i<=0||isNaN(i)){openNoty("error","Invalid Breakfast Amount");return false}k.addClass("disabled");$.post(a,{add_double:c,add_triple:j,add_extra:m,bf:i}).done(function(e){openNoty(e.result,e.message);k.removeClass("disabled").html(g)}).fail(function(){openNoty("error","Ajax Error");k.removeClass("disabled").html(g)})});$(document).on("click","#js-generate-tax-forms",function(f){f.preventDefault();var d=$(this);var a=d.html();var c=d.attr("data-url");var b=d.attr("data-status");if(b==="Error"){x0p("Error","No XML found, please Upload Report first","error",false);return false}if(d.hasClass("disabled")){return false}d.children().removeClass("fa-file-pdf-o").addClass("fa-spin").addClass("fa-spinner");d.addClass("disabled");$.post(c).done(function(e){d.removeClass("disabled").html(a);if(e.result==="success"){x0p("Success","Forms generated","ok",false).then(function(g){window.location=e.extra.link})}else{x0p("Error",e.message,"error",false)}d.children().addClass("fa-file-pdf-o").removeClass("fa-spin").removeClass("fa-spinner").removeClass("disabled");d.removeClass("disabled")}).fail(function(){openNoty("error","Ajax Error");d.children().addClass("fa-file-pdf-o").removeClass("fa-spin").removeClass("fa-spinner").removeClass("disabled");d.removeClass("disabled")})});$(document).on("click",".js-toggle-active",function(g){g.preventDefault();var f=$(this);var a=f.html();var c=f.attr("data-url");var b=f.attr("data-set");var d=f.attr("data-type");var h=f.attr("data-id");if(f.hasClass("disabled")){return false}f.addClass("disabled").html('<i class="fa fa-spin fa-spinner"></i>');$.post(c,{type:d,id:h,to_set:b}).done(function(i){f.removeClass("disabled").html(a);if(i.result==="success"){openNoty(i.result,i.message);var e=$("#status_"+d+"_"+h);if(e.length){e.removeClass("badge-danger").removeClass("badge-success").addClass("badge-"+i.extra.b_class).html(i.extra.b_html)}f.attr("data-set",i.extra.to_set_new).html(i.extra.html_new)}else{x0p("Error",i.message,"error",false)}}).fail(function(){openNoty("error","Ajax Error")})});$(document).on("change",".inputfile",function(c){var b=$(this);var a=$('label[for="'+b.attr("id")+'"]');uploadReport(b,a.html())});function uploadReport(e,c){var b=e.attr("data-url");var d=$("#form_"+e.attr("data-report-type"))[0];var f=new FormData(d);var a=$('label[for="'+e.attr("id")+'"]');if(a.hasClass("disabled")){return false}a.addClass("disabled").html('<i class="fa fa-spin fa-spinner"></i> <span>Uploading...</span>');$.ajax({url:b,type:"POST",data:f,processData:false,contentType:false,beforeSend:function(){},success:function(g){a.removeClass("disabled").html(c);openNoty(g.result,g.message)},error:function(i,g,h){openNoty("error","Upload failed");a.removeClass("disabled").html(c);console.log(h+"\r\n"+i.statusText+"\r\n"+i.responseText)}})}function openNoty(a,b){new Noty({layout:"topRight",theme:"mint",text:b,type:a,timeout:3000,buttons:false}).show()}function loadDetails(b,c){var a=$("#"+c);a.html('<i class="fa fa-spin fa-spinner fa-4x"></i>');$.post(b.attr("data-url")).done(function(e){a.html(e);var d=window.location.hash.split("load-");if(d.length){$('[data-device="'+d[1]+'"]').trigger("click")}$("#menuToggle > input").trigger("click");initOverlays();initModal();initScrollbar(".subScroll");initTooltips(".tt");$(".tooltipster-show").removeClass("tooltipster-show")})}function initOverlays(){cols.showOverlay=function(){$("body").addClass("show-main-overlay")};cols.hideOverlay=function(){$("body").removeClass("show-main-overlay")};cols.showMessage=function(){$("body").addClass("show-message");messageIsOpen=true};cols.hideMessage=function(){$("body").removeClass("show-message");messageIsOpen=false};cols.showSidebar=function(){$("body").addClass("show-sidebar")};cols.hideSidebar=function(){$("body").removeClass("show-sidebar")};$(".trigger-toggle-sidebar").on("click",function(){cols.showSidebar();cols.showOverlay()});$(".trigger-message-close").on("click",function(){var a=$(this).closest(".messageFly");if($(".messageFly").length<=1){cols.hideMessage();a.remove();history.pushState("",document.title,window.location.pathname)}else{a.animate({left:"9999px"},function(){a.remove()})}});$("#main > .overlay").on("click",function(){cols.hideOverlay();cols.hideMessage();cols.hideSidebar()})}function closeDetails(a){if(typeof a==="function"){$(".trigger-message-close").trigger("click",a())}else{$(".trigger-message-close").trigger("click")}}function detectHash(){var a=window.location.hash;if(!a.length){return false}$("[data-hash="+a.replace("#","")+"]").trigger("click")}function startTime(f){var b=new Date();var e=b.getHours();var a=b.getMinutes();var d=b.getSeconds();a=checkTime(a);d=checkTime(d);$("#startClock").html("@"+e+":"+a+":"+d+" Uhr");var c=setTimeout(startTime,1000)}function checkTime(a){if(a<10){a="0"+a}return a}function initModal(){[].slice.call($(".md-trigger")).forEach(function(c,b){var a=$("#"+c.getAttribute("data-modal"));c.addEventListener("click",function(d){a.addClass("md-show")})})}function initTooltips(a){$(a).tooltipster({theme:"tooltipster-punk",contentAsHTML:true,debug:false})}function initScrollbar(a){if($(a).length){new PerfectScrollbar(a,{suppressScrollX:true})}};