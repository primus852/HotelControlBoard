{% extends 'base.html.twig' %}

{% block body %}
    <main id="main">
        <div class="overlay"></div>
        <header class="header">
            <div class="row">
                <div class="col-11">
                    <h1 class="page-title">
                        <a class="sidebar-toggle-btn trigger-toggle-sidebar">
                            <span class="line"></span>
                            <span class="line"></span>
                            <span class="line"></span>
                            <span class="line line-angle1"></span>
                            <span class="line line-angle2"></span>
                        </a>Rateplan {{ date_string }}
                    </h1>
                </div>
                <div class="col-1 text-right">
                    <select id="js-select-rateplan-date">
                        {% for m in months %}
                            <option value="{{ m }}" {% if currMonth == m %}selected="selected"{% endif %}>{{ m }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </header>
        <div id="main-nano-wrapper" class="nano">
            <div class="nano-content" id="perfectScroll">
                <div class="container-fluid" id="js-result-table">
                    <div class="row">
                        <div class="col-12" style="height:250px;" id="js-chart-month">CHART</div>
                    </div>
                    <br/>
                    <div class="row" style="margin: 0 auto;">
                        {% for bookDate, hf in hfs %}
                            <div class="col-2 ratebox">
                                <span class="ratebox-rate edit" id="{{ hf.id }}_{{ bookDate }}">{{ hf.rate|number_format(2) }}</span>
                                <span class="ratebox-date">{{ bookDate|date('d.m.Y') }}</span>
                                <span class="ratebox-suggested tt text-{{ hf.suggested.useClass }}" id="sugg_{{ hf.id }}_{{ bookDate }}" title="Suggested Rate">{{ hf.suggested.rate|number_format(0) }}&euro;</span>
                                <span class="ratebox-stats tt" title="Arrivals/Departures/Occ/Avail/Pax"><i class="fa fa-arrow-down"></i> {{ hf.arrivals }} | <i class="fa fa-arrow-up"></i> {{ hf.departures }} | <i
                                            class="fa fa-percent"></i> {{ hf.occ|number_format(2) }} | <i class="fa fa-server"></i> {{ hf.avail }} | <i class="fa fa-users"></i> {{ hf.pax }}</span>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <br/>
        </div>
    </main>
{% endblock %}

{% block stylesheets %}

{% endblock stylesheets %}

{% block javascripts %}
    <script>
        var GetNav = "contentSettingsPrice";
    </script>
    <script type="text/javascript" src="{{ asset('node_modules/chartkick/dist/chartkick.js') }}"></script>
    <script type="text/javascript" src="{{ asset('node_modules/chart.js/dist/Chart.bundle.min.js') }}"></script>
    <script>

        $(document).ready(function () {

            {% set chartRate = "" %}
            {% set chartAvail = "" %}
            {% for bookDate, hf in hfs %}
            {% set chartRate = chartRate ~ "\""~ bookDate ~"\": "~ hf.rate~"," %}
            {% set chartAvail = chartAvail ~ "\""~ bookDate ~"\": "~ hf.avail~"," %}
            {% endfor %}

            var data = [
                {name: "Rate", data: {{ ("{"~chartRate~"}}")|raw }},
                {name: "Available Rooms", data: {{ ("{"~chartAvail~"}}")|raw }}
            ];
            new Chartkick.LineChart("js-chart-month", data);

            $('.edit').each(function () {

                var v = $(this);
                var id = v.attr('id');

                v.editable('{{ path('ajaxEditRateplan') }}', {
                    select: true,
                    callback: function (result, settings, submitdata) {
                        var r = parseFloat(result);
                        var $sugg = $('#sugg_' + id);
                        var sugg = parseFloat($sugg.html().replace('â‚¬', '').replace('&euro;', ''));
                        var diff = Math.abs(r - sugg);
                        if (diff >= 10 && diff < 30) {
                            $sugg.removeClass('text-success').removeClass('text-danger').addClass('text-warning');
                        } else if (diff >= 30) {
                            $sugg.removeClass('text-success').removeClass('text-warning').addClass('text-danger');
                        } else {
                            $sugg.removeClass('text-warning').removeClass('text-danger').addClass('text-success');
                        }
                    }
                });

            });


        });

        $(document).on('change', '#js-select-rateplan-date', function () {
            window.location.assign('{{ path('settingsRateplan') }}/' + $(this).val());
        });
    </script>
{% endblock javascripts %}

